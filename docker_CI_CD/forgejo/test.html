<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Forgejo Runner Documentation</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 2em;
      background-color: #f9f9f9;
      color: #333;
    }
    h1, h2, h3 {
      color: #005a9c;
    }
    code, pre {
      background-color: #eee;
      padding: 0.5em;
      border-radius: 4px;
      display: block;
      overflow-x: auto;
    }
    ul {
      margin-top: 0;
    }
    .tip {
      background-color: #dff0d8;
      padding: 1em;
      border-left: 5px solid #3c763d;
      margin: 1em 0;
    }
  </style>
</head>
<body>

  <h1>Forgejo Runner Label Management & Workflow Execution Guide</h1>
  <p>This guide explains how to inspect and modify Forgejo runner labels, and verify workflow execution environments.</p>

  <h2>üßæ Check Current Runner Labels</h2>
  <pre><code>cat data/.runner</code></pre>
  <p>Example output:</p>
  <pre><code>{
  "WARNING": "This file is automatically generated by act-runner. Do not edit it manually unless you know what you are doing. Removing this file will cause act runner to re-register as a new runner.",
  "id": 3,
  "uuid": "34395e61-b83f-4e33-88e7-15997d700b07",
  "name": "forgejo-runner",
  "token": "eff066b6ea6a1911604f13e13feadf3705e3f944",
  "address": "http://10.13.14.30:3000",
  "labels": [
    "ubuntu-22.04:docker://ghcr.io/catthehacker/ubuntu:act-22.04",
    "self-hosted:host",
    "docker:docker://node:22-bookworm"
  ]
}</code></pre>

  <h2>üõ†Ô∏è Update Runner Labels</h2>
  <ol>
    <li><strong>Stop the runner container:</strong>
      <pre><code>docker compose down</code></pre>
    </li>
    <li><strong>Edit the <code>.runner</code> file:</strong>
      <pre><code>sudo nano data/.runner</code></pre>
    </li>
    <li><strong>Restart the runner container:</strong>
      <pre><code>docker compose up -d</code></pre>
    </li>
    <li><strong>Verify runner status:</strong>
      <p>Go to: <code>https://forgejo.rayka-co.com ‚Üí Settings ‚Üí Actions ‚Üí Runners</code></p>
      <div class="tip">
        Status should be <strong>Idle</strong> or <strong>Active</strong>. If <strong>Offline</strong>, check for JSON syntax errors in <code>.runner</code>.
      </div>
    </li>
  </ol>

  <h2>üß™ Example 1: Workflow on Container-Based Label</h2>
  <p><strong>Workflow file:</strong> <code>.forgejo/workflows/training1.yml</code> or <code>.github/workflows/test-ubuntu22.yml</code></p>
  <pre><code>name: Test Ubuntu-22.04 Container

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: [ubuntu-22.04]
    steps:
      - uses: actions/checkout@v4
      - run: |
          echo "Hello from pinned Ubuntu-22.04 container!"
          uname -a
          sleep 120</code></pre>

  <p><strong>Verify container execution:</strong></p>
  <pre><code>docker ps -a
docker exec -it docker_dind sh
docker ps -a
docker exec -it &lt;container_id&gt; bash
ps aux</code></pre>

  <p>Expected container name format:</p>
  <pre><code>FORGEJO-ACTIONS-TASK-&lt;TASK_ID&gt;_WORKFLOW-&lt;WORKFLOW_ID&gt;_JOB-&lt;JOB_NAME&gt;</code></pre>

  <h2>üß™ Example 2: Workflow on Host-Based Label</h2>
  <p><strong>Workflow file:</strong> <code>.forgejo/workflows/training2.yml</code></p>
  <pre><code>name: Host runner demo

on:
  workflow_dispatch:

jobs:
  host-job:
    runs-on: self-hosted
    steps:
      - name: Run directly on host
        run: |
          echo "This runs on the host"
          uname -a
          id -u
          touch /tmp/host_demo
          ls -l /tmp/host_demo
          sleep 133</code></pre>

  <p><strong>Verify host execution:</strong></p>
  <pre><code>docker ps -a
docker exec -it runner bash
ps aux</code></pre>

  <p>Expected process:</p>
  <pre><code>bash --noprofile --norc -e -o pipefail /data/.cache/act/&lt;hash&gt;/act/workflow/0.sh</code></pre>

  <h2>‚úÖ Tips</h2>
  <ul>
    <li>Always validate <code>.runner</code> JSON syntax before restarting.</li>
    <li>Use descriptive labels to distinguish container vs host execution.</li>
    <li>Use <code>sleep</code> in workflows to allow time for inspection.</li>
  </ul>

  <p><strong>Happy automating! üöÄ</strong></p>

</body>
</html>
